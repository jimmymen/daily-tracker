<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI å®æ—¶æ—¥ç¨‹ Pro</title>
    <!-- å¼•å…¥ç›¸åŒçš„æ ·å¼é£æ ¼ï¼Œä¿æŒä¸€è‡´æ€§ -->
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; }
        body { font-family: system-ui; background: var(--bg); padding: 20px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .schedule-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
        .tag { padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; background: #dbeafe; }
    </style>
</head>
<body>

    <div id="loginSection">
        <button onclick="login()">Google ç™»å½•åŒæ­¥æ—¥ç¨‹</button>
    </div>

    <div id="app" style="display:none;">
        <div class="card">
            <h2>âœ¨ AI å¿«é€Ÿæ·»åŠ </h2>
            <textarea id="aiInput" placeholder="ä¾‹å¦‚ï¼šæ˜å¤©ä¸‹åˆ3ç‚¹å’Œå¼ æ€»åœ¨å’–å•¡å…å¼€ä¼š..."></textarea>
            <button onclick="processAI()">è¯†åˆ«å¹¶åŒæ­¥</button>
        </div>

        <div class="card">
            <h2>ğŸ“… æˆ‘çš„æ—¥ç¨‹ (å®æ—¶åŒæ­¥)</h2>
            <div id="scheduleList">æ­£åœ¨è¿æ¥å®æ—¶æ•°æ®åº“...</div>
        </div>
    </div>

    <!-- Firebase SDK æ¨¡å—åŒ–å¼•å…¥ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // 1. é…ç½®ä¿¡æ¯ (æ›¿æ¢ä¸ºä½ è‡ªå·±çš„)
        const firebaseConfig = {
            apiKey: "ä½ çš„API_KEY",
            authDomain: "ä½ çš„é¡¹ç›®.firebaseapp.com",
            projectId: "ä½ çš„é¡¹ç›®ID",
            storageBucket: "ä½ çš„é¡¹ç›®.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;

        // 2. æ ¸å¿ƒï¼šèº«ä»½çŠ¶æ€ç›‘å¬
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                // å¼€å¯å®æ—¶æ•°æ®åŒæ­¥
                startLiveSync(user.uid);
            }
        });

        // 3. æ ¸å¿ƒï¼šå®æ—¶åŒæ­¥é€»è¾‘ (å€Ÿé‰´ä½ ä»£ç ä¸­çš„ snapShot)
        function startLiveSync(uid) {
            const q = query(
                collection(db, `users/${uid}/schedules`), 
                orderBy("startTime", "asc")
            );

            // è¿™ä¸ªå‡½æ•°ä¼šä¸€ç›´æŒ‚è½½ï¼Œæ•°æ®åº“ä¸€å˜ï¼ŒUI ç«‹å³å˜
            onSnapshot(q, (snapshot) => {
                const listEl = document.getElementById('scheduleList');
                let html = '';
                
                snapshot.forEach((doc) => {
                    const item = doc.data();
                    html += `
                        <div class="schedule-item">
                            <div>
                                <strong>${item.title}</strong>
                                <span class="tag">${item.startTime}</span>
                            </div>
                            <button onclick="deleteTask('${doc.id}')">ğŸ—‘ï¸</button>
                        </div>
                    `;
                });
                
                listEl.innerHTML = html || 'æš‚æ— æ—¥ç¨‹ï¼Œè¯·æ·»åŠ ';
            });
        }

        // 4. AI è¯†åˆ«å¤„ç† (å€Ÿé‰´ä½ ä»£ç ä¸­çš„ DeepSeek æ€è·¯)
        window.processAI = async () => {
            const text = document.getElementById('aiInput').value;
            // æç¤ºè¯å·¥ç¨‹ï¼šå¼ºåˆ¶ AI è¿”å›æ—¥ç¨‹ç›¸å…³çš„ JSON
            const prompt = "å°†ä»¥ä¸‹æ–‡å­—è½¬åŒ–ä¸ºæ—¥ç¨‹JSONå¯¹è±¡ï¼ŒåŒ…å«å­—æ®µï¼štitle, startTime(YYYY-MM-DD HH:mm), location, category";
            
            /* è¿™é‡Œè°ƒç”¨ AI API (fetch DeepSeek...) */
            // å‡è®¾ AI è¿”å›äº†ç»“æœï¼š
            const aiResult = {
                title: "å’Œå¼ æ€»å¼€ä¼š",
                startTime: "2023-11-20 15:00",
                location: "å’–å•¡å…",
                category: "å·¥ä½œ"
            };

            // ç›´æ¥å­˜å…¥ Firebaseï¼Œæ‰€æœ‰ç«¯ä¼šè‡ªåŠ¨åŒæ­¥æ˜¾ç¤º
            await addDoc(collection(db, `users/${currentUser.uid}/schedules`), aiResult);
            document.getElementById('aiInput').value = '';
        };

        // åˆ é™¤é€»è¾‘
        window.deleteTask = async (id) => {
            await deleteDoc(doc(db, `users/${currentUser.uid}/schedules`, id));
        };

        window.login = () => signInWithPopup(auth, provider);

    </script>
</body>
</html>
